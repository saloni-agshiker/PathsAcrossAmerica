{% extends 'base.html' %}
{% block content %}
{% load static %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="card shadow p-3 mb-4 rounded">
        <div class="card-body">
          <b class="text-start">Add a Running Place
            </b><br /><br />
          <form onsubmit="return validateAddress()" method="POST" action="{% url 'running_places.create_running_place' %}">
            {% csrf_token %}
            {% if template_data.error %}
                <div class="alert alert-danger mt-3">{{ template_data.error }}</div>
            {% endif %}
            <p>
              <label for="name">Name:</label>
              <textarea name="name" required
              class="form-control"
              id="name"></textarea>
            </p>
            <p>
              <label for="autocomplete">Address:</label>
              <input id="autocomplete" type="text" name="address" required class="form-control">

              <script>
              function validateAddress() {
              const addressInput = document.getElementById('address');
              if (!addressInput.value || addressInput.value.length < 5) {
                alert("Please enter a valid address.");
                return false;
              }
                  return true;
              }
              console.log("Fetching Maps API key...");
  fetch('/api/get_maps_key') // Make sure this matches your Django route
    .then(response => {
      if (!response.ok) {
        throw new Error(`Network response was not ok: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log("Received API key:", data.key);

      const script = document.createElement('script');
      script.src = `https://maps.googleapis.com/maps/api/js?key=${data.key}&libraries=places&callback=initAutocomplete`;
      script.async = true;

      script.onload = () => {
        console.log("Google Maps script loaded successfully.");
      };

      script.onerror = () => {
        console.error("Failed to load Google Maps script.");
      };

      document.head.appendChild(script);
    })
    .catch(error => {
      console.error("Error fetching Maps API key:", error);
    });

  function initAutocomplete() {
    console.log("Initializing autocomplete...");
    const input = document.getElementById('autocomplete');
    if (!input) {
      console.error("Autocomplete input field not found.");
      return;
    }
    new google.maps.places.Autocomplete(input, { types: ['address'] });
    console.log("Autocomplete initialized.");
  }
</script>
            </p>
            <p>
              <label for="description">Description:</label>
              <textarea name="description" required
              class="form-control"
              id="description"></textarea>
            </p>
            <p>
              <label>Path Type:</label>
              <label>
                <input type="radio" name ="path_type" value="GR"> Gravel
              </label>
              <label>
                <input type="radio" name ="path_type" value="DT"> Dirt
              </label>
              <label>
                <input type="radio" name ="path_type" value="PV"> Paved
              </label>
              <label>
                <input type="radio" name ="path_type" value="CO"> Concrete
              </label>
            </p>
            <p>
              <label>Terrain Type:</label>
              <label>
                <input type="radio" name ="terrain_type" value="FL"> Flat
              </label>
              <label>
                <input type="radio" name ="terrain_type" value="HL"> Hilly
              </label>
            </p>
            <p>
              <label for="length">Length of the path (in miles):</label>
              <input type="number" id="length" name="length">
            </p>
            <p>
              <label>Parking Type:</label>
              <label>
                <input type="radio" name ="parking" value="Free"> Free
              </label>
              <label>
                <input type="radio" name ="parking" value="Paid"> Paid
              </label>
            </p>
            <p>
              <label>Public Restrooms:</label>
              <label>
                <input type="radio" name ="restroom" value="Y"> Yes
              </label>
              <label>
                <input type="radio" name ="restroom" value="N"> No
              </label>
            </p>
            <div class="text-center">
              <button type="submit"
                class="btn bg-dark text-white">
                Add Running Place
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}