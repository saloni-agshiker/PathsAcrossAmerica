{% extends 'base.html' %}
{% block content %}
{% load static %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="card shadow p-3 mb-4 rounded">
        <div class="card-body">
          <b class="text-start">Add a Running Place
            </b><br /><br />
          <form onsubmit="return validateAddress()" method="POST" action="{% url 'running_places.create_running_place' %}">
            {% csrf_token %}
            <p>
              <label for="name">Name:</label>
              <textarea name="name" required
              class="form-control"
              id="name"></textarea>
            </p>
            <p>
              <label for="address">Address:</label>
              <input id="address" type="text" name="address" required class="form-control">
            </p>
            <p>
              <label for="description">Description:</label>
              <textarea name="description" required
              class="form-control"
              id="description"></textarea>
            </p>
            <p>
              <label>Path Type:</label>
              <label>
                <input type="radio" name ="path_type" value="GR"> Gravel
              </label>
              <label>
                <input type="radio" name ="path_type" value="DT"> Dirt
              </label>
              <label>
                <input type="radio" name ="path_type" value="PV"> Paved
              </label>
              <label>
                <input type="radio" name ="path_type" value="CO"> Concrete
              </label>
            </p>
            <p>
              <label>Terrain Type:</label>
              <label>
                <input type="radio" name ="terrain_type" value="FL"> Flat
              </label>
              <label>
                <input type="radio" name ="terrain_type" value="HL"> Hilly
              </label>
            </p>
            <p>
              <label for="length">Length of the path (in miles):</label>
              <input type="number" id="length" name="length">
            </p>
            <p>
              <label>Parking Type:</label>
              <label>
                <input type="radio" name ="parking" value="Free"> Free
              </label>
              <label>
                <input type="radio" name ="parking" value="Paid"> Paid
              </label>
            </p>
            <p>
              <label>Public Restrooms:</label>
              <label>
                <input type="radio" name ="restroom" value="Y"> Yes
              </label>
              <label>
                <input type="radio" name ="restroom" value="N"> No
              </label>
            </p>
            <div class="text-center">
              <button type="submit"
                class="btn bg-dark text-white">
                Add Running Place
              </button>
            </div>
          </form>

          <script>
            function initAutocomplete() {
              const input = document.getElementById('address');
              const autocomplete = new google.maps.places.Autocomplete(input, {
                types: ['address'],
                fields: ['formatted_address']
              });
            }

            function validateAddress() {
              const addressInput = document.getElementById('address');
              if (!addressInput.value || addressInput.value.length < 5) {
                alert("Please enter a valid address.");
                return false;
              }
              return true;
            }

            fetch('/api/get-maps-key')
                    .then(response => response.json())
                    .then(data => {
                      const script = document.createElement('script');
                      script.src = `https://maps.googleapis.com/maps/api/js?key=${data.key}&libraries=places&callback=initAutocomplete`;

                      script.onload = () => {
                        const input = document.getElementById('autocomplete');
                        new google.maps.places.Autocomplete(input, { types: ['address'] });
                      };
                      document.head.appendChild(script);
                    });
          </script>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}